<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products - TC SignLab</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #E63946;
            --secondary: #1D3557;
            --light: #F8F9FA;
            --border: #DEE2E6;
            --text: #212529;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--light);
        }
        
        .header {
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .nav {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            color: var(--primary);
            font-size: 1.8rem;
            font-weight: 700;
        }
        
        .logo img {
            height: 50px;
        }
        
        .nav-links {
            display: flex;
            gap: 30px;
            align-items: center;
        }
        
        .nav-links a {
            text-decoration: none;
            color: var(--text);
            font-weight: 600;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-outline {
            border: 2px solid var(--primary);
            color: var(--primary);
            background: transparent;
        }
        
        .hero {
            background: linear-gradient(135deg, rgba(230, 57, 70, 0.95), rgba(29, 53, 87, 0.95));
            color: white;
            padding: 60px 30px;
            text-align: center;
        }
        
        .hero h1 {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        
        .hero p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .container {
            max-width: 1400px;
            margin: 40px auto;
            padding: 0 30px;
        }
        
        .filters {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .filter-group {
            flex: 1;
            min-width: 200px;
        }
        
        .filter-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--secondary);
        }
        
        .filter-group select,
        .filter-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid var(--border);
            border-radius: 6px;
            font-size: 1rem;
        }
        
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .product-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        
        .product-image {
            height: 220px;
            background: linear-gradient(135deg, var(--primary), #D62828);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 5rem;
            position: relative;
            overflow: hidden;
        }
        
        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .product-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255,255,255,0.95);
            color: var(--primary);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 700;
        }
        
        .product-info {
            padding: 25px;
        }
        
        .product-category {
            color: #999;
            font-size: 0.85rem;
            text-transform: uppercase;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .product-name {
            font-size: 1.4rem;
            color: var(--secondary);
            margin-bottom: 12px;
            font-weight: 700;
        }
        
        .product-description {
            color: #666;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .product-price {
            font-size: 1.3rem;
            color: var(--primary);
            font-weight: 700;
            margin-bottom: 15px;
        }
        
        .product-price.hidden {
            color: #999;
            font-size: 1rem;
        }
        
        .product-actions {
            display: flex;
            gap: 10px;
        }
        
        .product-actions .btn {
            flex: 1;
            text-align: center;
        }
        
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .alert-info {
            background: #D1ECF1;
            color: #0C5460;
            border: 2px solid #BEE5EB;
        }
        
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: #999;
        }
        
        .empty-state-icon {
            font-size: 5rem;
            margin-bottom: 20px;
        }
        
        .loading {
            text-align: center;
            padding: 60px 20px;
        }
        
        .spinner {
            border: 4px solid var(--light);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2rem;
            }
            
            .filters {
                flex-direction: column;
            }
            
            .products-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <nav class="nav">
            <a href="/" class="logo">
                <img src="tcsignlab.png" alt="TC SignLab" onerror="this.style.display='none'">
                <span>TC SignLab</span>
            </a>
            <div class="nav-links">
                <a href="/products.html">Products</a>
                <a href="/configurator.html">Design Tool</a>
                <a href="/dashboard.html" id="dashboardLink" style="display: none;">Dashboard</a>
                <a href="/login.html" class="btn btn-outline" id="authBtn">Login</a>
            </div>
        </nav>
    </div>
    
    <div class="hero">
        <h1>Our Products</h1>
        <p>Professional custom signs and graphics for every need</p>
    </div>
    
    <div class="container">
        <div id="loginAlert"></div>
        
        <div class="filters">
            <div class="filter-group">
                <label>Search Products</label>
                <input type="text" id="searchInput" placeholder="Search by name..." onkeyup="filterProducts()">
            </div>
            <div class="filter-group">
                <label>Category</label>
                <select id="categoryFilter" onchange="filterProducts()">
                    <option value="">All Categories</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Sort By</label>
                <select id="sortFilter" onchange="filterProducts()">
                    <option value="name">Name (A-Z)</option>
                    <option value="price-low">Price (Low to High)</option>
                    <option value="price-high">Price (High to Low)</option>
                </select>
            </div>
        </div>
        
        <div id="loadingScreen" class="loading">
            <div class="spinner"></div>
            <h3>Loading products...</h3>
        </div>
        
        <div id="productsGrid" class="products-grid" style="display: none;"></div>
    </div>
    
    <script type="module">
        import { auth, database, onAuthStateChanged, ref, get } from './firebase-auth.js';
        import { getDatabase } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
        
        let isLoggedIn = false;
        let allProducts = [];
        let categories = {};
        
        // Check authentication
        onAuthStateChanged(auth, (user) => {
            isLoggedIn = !!user;
            
            const authBtn = document.getElementById('authBtn');
            const dashboardLink = document.getElementById('dashboardLink');
            const loginAlert = document.getElementById('loginAlert');
            
            if (user) {
                authBtn.textContent = user.email.split('@')[0];
                authBtn.href = '/dashboard.html';
                dashboardLink.style.display = 'block';
                loginAlert.innerHTML = '';
            } else {
                authBtn.textContent = 'Login';
                authBtn.href = '/login.html';
                dashboardLink.style.display = 'none';
                loginAlert.innerHTML = `
                    <div class="alert alert-info">
                        <span>üîí</span>
                        <span><strong>Login to see pricing.</strong> Create a free account to view prices and place orders. <a href="/login.html" style="color: var(--primary); font-weight: 700;">Sign up now</a></span>
                    </div>
                `;
            }
            
            // Reload products to update pricing visibility
            if (allProducts.length > 0) {
                displayProducts(allProducts);
            }
        });
        
        // Load products and categories
        async function loadData() {
            try {
                // Load categories
                const categoriesRef = ref(database, 'categories');
                const categoriesSnap = await get(categoriesRef);
                categories = categoriesSnap.val() || {};
                
                // Populate category filter
                const categoryFilter = document.getElementById('categoryFilter');
                Object.entries(categories).forEach(([id, cat]) => {
                    categoryFilter.innerHTML += `<option value="${id}">${cat.name}</option>`;
                });
                
                // Load products
                const productsRef = ref(database, 'products');
                const productsSnap = await get(productsRef);
                const productsData = productsSnap.val() || {};
                
                allProducts = Object.entries(productsData)
                    .filter(([id, product]) => product.active !== false)
                    .map(([id, product]) => ({ id, ...product }));
                
                document.getElementById('loadingScreen').style.display = 'none';
                document.getElementById('productsGrid').style.display = 'grid';
                
                displayProducts(allProducts);
            } catch (error) {
                console.error('Error loading products:', error);
                document.getElementById('loadingScreen').innerHTML = `
                    <h3 style="color: var(--primary);">Error loading products</h3>
                    <p>Please refresh the page</p>
                `;
            }
        }
        
        function displayProducts(products) {
    const container = document.getElementById('productsList');
    
    if (products.length === 0) {
        container.innerHTML = '<p>No products yet. Add your first product!</p>';
        return;
    }
    
    container.innerHTML = products.map(product => `
        <div class="product-item" style="border:2px solid #dee2e6; padding:20px; border-radius:10px; margin-bottom:15px;">
            <div style="display:flex; justify-content:space-between; align-items:start;">
                <div style="flex:1;">
                    <h3 style="color:#1D3557; margin-bottom:10px;">${product.name}</h3>
                    <p style="color:#666; margin-bottom:10px;">${product.description || 'No description'}</p>
                    <div style="display:flex; gap:20px; margin-bottom:10px;">
                        <span><strong>Base Price:</strong> $${product.basePrice}/sq ft</span>
                        <span><strong>Category:</strong> ${categories[product.category]?.name || 'N/A'}</span>
                        <span><strong>Status:</strong> ${product.active ? '‚úì Active' : '‚úó Inactive'}</span>
                    </div>
                    
                    ${product.materialOptions && product.materialOptions.length > 0 ? `
                        <div style="background:#f8f9fa; padding:10px; border-radius:6px; margin-top:10px;">
                            <strong>Material Options (${product.materialOptions.length}):</strong>
                            <ul style="margin:5px 0 0 20px;">
                                ${product.materialOptions.map(mat => `
                                    <li>${mat.name} (+$${mat.priceModifier}) - Max: ${mat.maxWidth}"W x ${mat.maxHeight}"H</li>
                                `).join('')}
                            </ul>
                        </div>
                    ` : '<p style="color:#dc3545; margin-top:10px;">‚ö†Ô∏è No material options</p>'}
                </div>
                
                <div style="display:flex; gap:10px;">
                    <button onclick="editProduct('${product.id}')" class="btn btn-sm btn-secondary">Edit</button>
                    <button onclick="deleteProduct('${product.id}')" class="btn btn-sm btn-danger">Delete</button>
                </div>
            </div>
        </div>
    `).join('');
}

        window.filterProducts = function() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const sortFilter = document.getElementById('sortFilter').value;
            
            let filtered = allProducts.filter(product => {
                const matchesSearch = product.name.toLowerCase().includes(searchTerm) ||
                    (product.description && product.description.toLowerCase().includes(searchTerm));
                const matchesCategory = !categoryFilter || product.category === categoryFilter;
                
                return matchesSearch && matchesCategory;
            });
            
            // Sort
            filtered.sort((a, b) => {
                if (sortFilter === 'name') {
                    return a.name.localeCompare(b.name);
                } else if (sortFilter === 'price-low') {
                    return (a.basePrice || 0) - (b.basePrice || 0);
                } else if (sortFilter === 'price-high') {
                    return (b.basePrice || 0) - (a.basePrice || 0);
                }
                return 0;
            });
            
            displayProducts(filtered);
        };
        
        // Load data on page load
        loadData();
    </script>
</body>
</html>
