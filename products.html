<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products - TC SignLab</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --primary: #E63946; --secondary: #1D3557; --light: #F8F9FA; --border: #DEE2E6; --text: #212529; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--light); }
        .header { background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100; }
        .nav { max-width: 1400px; margin: 0 auto; padding: 20px 30px; display: flex; justify-content: space-between; align-items: center; }
        .logo { display: flex; align-items: center; gap: 10px; text-decoration: none; color: var(--primary); font-size: 1.8rem; font-weight: 700; }
        .logo img { height: 50px; }
        .nav-links { display: flex; gap: 30px; align-items: center; }
        .nav-links a { text-decoration: none; color: var(--text); font-weight: 600; transition: color 0.2s; }
        .nav-links a:hover { color: var(--primary); }
        .hero { background: linear-gradient(135deg, rgba(230, 57, 70, 0.95), rgba(29, 53, 87, 0.95)); color: white; padding: 60px 30px; text-align: center; }
        .hero h1 { font-size: 3rem; margin-bottom: 20px; }
        .container { max-width: 1400px; margin: 40px auto; padding: 0 30px; }
        .filters { background: white; padding: 20px; border-radius: 8px; margin-bottom: 30px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); display: flex; gap: 20px; flex-wrap: wrap; }
        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }
        .product-card { background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.2s; cursor: pointer; }
        .product-card:hover { transform: translateY(-5px); }
        .product-image { width: 100%; height: 250px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; font-size: 4rem; }
        .product-image img { width: 100%; height: 100%; object-fit: cover; }
        .product-info { padding: 20px; }
        .product-title { font-size: 1.3rem; font-weight: 700; color: var(--secondary); margin-bottom: 10px; }
        .product-description { color: #666; font-size: 0.95rem; margin-bottom: 15px; }
        .product-price { font-size: 1.5rem; font-weight: 700; color: var(--primary); margin-bottom: 15px; }
        .product-actions { display: flex; gap: 10px; }
        .btn { padding: 12px 20px; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; text-align: center; flex: 1; transition: all 0.2s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: #d62828; }
        .btn-secondary { background: var(--secondary); color: white; }
        .btn-secondary:hover { background: #14213d; }
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center; padding: 20px; }
        .modal.show { display: flex; }
        .modal-content { background: white; border-radius: 10px; max-width: 600px; width: 100%; max-height: 85vh; overflow-y: auto; padding: 30px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-weight: 600; margin-bottom: 8px; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; }
    </style>
</head>
<body>
    <div class="header">
        <nav class="nav">
            <a href="./index.html" class="logo">
                <img src="./tcsignlab.png" alt="TC SignLab" onerror="this.style.display='none'">
                <span>TC SignLab</span>
            </a>
            <div class="nav-links">
                <a href="./index.html">Home</a>
                <a href="./products.html">Products</a>
                <a href="./configurator.html">Design Tool</a>
                <a href="./checkout.html">Cart</a>
                <a href="./login.html">Login</a>
            </div>
        </nav>
    </div>
    
    <div class="hero">
        <h1>Our Products</h1>
        <p>Professional signage solutions for your business</p>
    </div>
    
    <div class="container">
        <div class="filters">
            <div>
                <label>Category:</label>
                <select id="categoryFilter" onchange="filterProducts()">
                    <option value="">All Categories</option>
                </select>
            </div>
            <div>
                <input type="text" id="searchInput" placeholder="Search products..." oninput="filterProducts()" style="padding:10px; border:1px solid #ccc; border-radius:6px;">
            </div>
        </div>
        
        <div class="products-grid" id="productsGrid"></div>
    </div>
    
    <div id="quoteModal" class="modal">
        <div class="modal-content">
            <h2>Request Quote</h2>
            <form id="quoteForm" onsubmit="submitQuote(event)">
                <div style="background: #f8f9fa; padding: 15px; border-radius: 6px; margin-bottom: 20px;">
                    <h3 id="quoteProductName"></h3>
                    <p id="quoteProductDetails" style="color: #666;"></p>
                </div>
                <div class="form-group"><label>Name *</label><input type="text" id="quoteName" required></div>
                <div class="form-group"><label>Email *</label><input type="email" id="quoteEmail" required></div>
                <div class="form-group"><label>Phone</label><input type="tel" id="quotePhone"></div>
                <div class="form-group"><label>Company</label><input type="text" id="quoteCompany"></div>
                <div class="form-group"><label>Quantity *</label><input type="number" id="quoteQuantity" value="1" min="1" required></div>
                <div class="form-group"><label>Size/Dimensions</label><input type="text" id="quoteSize" placeholder="e.g., 2ft x 4ft"></div>
                <div class="form-group" id="finishingGroup" style="display:none;">
                    <label>Finishing Options</label>
                    <div id="finishingList"></div>
                </div>
                <div class="form-group"><label>Notes</label><textarea id="quoteNotes" rows="4"></textarea></div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Send Quote Request</button>
                <button type="button" class="btn" onclick="closeModal()" style="background: #6c757d; color: white; width: 100%; margin-top: 10px;">Cancel</button>
            </form>
        </div>
    </div>
    
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, onValue } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
        
        const app = initializeApp({
            apiKey: "AIzaSyAlrfBLg-yJtUzYYJKGfGICS_PQuGE8caY",
            authDomain: "tcsignlab-admin.firebaseapp.com",
            databaseURL: "https://tcsignlab-admin-default-rtdb.firebaseio.com",
            projectId: "tcsignlab-admin",
            storageBucket: "tcsignlab-admin.firebasestorage.app",
            messagingSenderId: "382892123645",
            appId: "1:382892123645:web:cf45e472749c66165d6594"
        });
        
        const database = getDatabase(app);
        let products = [], categories = {}, selectedProduct = null;
        
        onValue(ref(database, 'categories'), (snapshot) => {
            categories = snapshot.val() || {};
            const select = document.getElementById('categoryFilter');
            select.innerHTML = '<option value="">All Categories</option>' + 
                Object.entries(categories).map(([id, cat]) => `<option value="${id}">${cat.name}</option>`).join('');
        });
        
        onValue(ref(database, 'products'), (snapshot) => {
            const data = snapshot.val() || {};
            products = Object.entries(data).map(([id, p]) => ({id, ...p})).filter(p => p.active);
            displayProducts(products);
        });
        
        function displayProducts(list) {
            const grid = document.getElementById('productsGrid');
            if (list.length === 0) { grid.innerHTML = '<p>No products found.</p>'; return; }
            grid.innerHTML = list.map(p => `
                <div class="product-card" onclick="viewProduct('${p.id}')">
                    <div class="product-image">${p.imageUrl ? `<img src="${p.imageUrl}" alt="${p.name}">` : 'ðŸ“¦'}</div>
                    <div class="product-info">
                        <div class="product-title">${p.name}</div>
                        <div class="product-description">${(p.description || 'Quality product').substring(0, 100)}...</div>
                        <div class="product-price">From $${p.basePrice}/sq ft</div>
                        <div class="product-actions">
                            <button class="btn btn-secondary" onclick="event.stopPropagation(); viewProduct('${p.id}')">View Details</button>
                            <button class="btn btn-primary" onclick="event.stopPropagation(); requestQuote('${p.id}')">Get Quote</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        window.filterProducts = function() {
            const category = document.getElementById('categoryFilter').value;
            const search = document.getElementById('searchInput').value.toLowerCase();
            let filtered = products;
            if (category) filtered = filtered.filter(p => p.category === category);
            if (search) filtered = filtered.filter(p => p.name.toLowerCase().includes(search) || (p.description || '').toLowerCase().includes(search));
            displayProducts(filtered);
        };
        
        window.viewProduct = function(id) {
            window.location.href = `./product.html?id=${id}`;
        };
        
        window.requestQuote = function(id) {
            const p = products.find(pr => pr.id === id);
            if (!p) return;
            selectedProduct = p;
            document.getElementById('quoteProductName').textContent = p.name;
            document.getElementById('quoteProductDetails').textContent = `Base: $${p.basePrice}/sq ft | Max: ${p.maxWidth || 'N/A'}" x ${p.maxHeight || 'N/A'}"`;
            const fg = document.getElementById('finishingGroup'), fl = document.getElementById('finishingList');
            if (p.finishingOptions && p.finishingOptions.length > 0) {
                fg.style.display = 'block';
                fl.innerHTML = p.finishingOptions.map(o => `
                    <label style="display:block; margin:8px 0;">
                        <input type="checkbox" name="finishing" value="${o.name}">
                        ${o.name} ${o.price > 0 ? `(+$${o.price})` : ''} - ${o.description || ''}
                    </label>
                `).join('');
            } else { fg.style.display = 'none'; }
            document.getElementById('quoteModal').classList.add('show');
        };
        
        window.submitQuote = async function(e) {
            e.preventDefault();
            const finishing = Array.from(document.querySelectorAll('input[name="finishing"]:checked')).map(c => c.value);
            try {
                await fetch('https://formsubmit.co/tcsignlab@gmail.com', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        _subject: `TC SignLab - Quote: ${selectedProduct.name}`,
                        _template: 'box',
                        Product: selectedProduct.name,
                        'Base Price': `$${selectedProduct.basePrice}/sq ft`,
                        Name: document.getElementById('quoteName').value,
                        Email: document.getElementById('quoteEmail').value,
                        Phone: document.getElementById('quotePhone').value || 'N/A',
                        Company: document.getElementById('quoteCompany').value || 'N/A',
                        Quantity: document.getElementById('quoteQuantity').value,
                        Size: document.getElementById('quoteSize').value || 'N/A',
                        'Finishing': finishing.join(', ') || 'None',
                        Notes: document.getElementById('quoteNotes').value || 'None'
                    })
                });
                alert('âœ“ Quote sent! We\'ll respond within 24 hours.');
                closeModal();
                document.getElementById('quoteForm').reset();
            } catch { alert('âŒ Error. Please call 866-419-7446.'); }
        };
        
        window.closeModal = () => document.querySelectorAll('.modal').forEach(m => m.classList.remove('show'));
    </script>
</body>
</html>
