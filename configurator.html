<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Design & Request Quote - TC SignLab</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Roboto', Arial, sans-serif; background: #f5f5f5; color: #333; }
        .top-bar { background: #1D3557; padding: 10px 0; text-align: center; }
        .top-bar img { height: 40px; }
        .header { background: white; border-bottom: 3px solid #0066cc; padding: 15px 0; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .header-content { max-width: 1400px; margin: 0 auto; padding: 0 20px; display: flex; justify-content: space-between; align-items: center; }
        .header h1 { color: #0066cc; font-size: 1.8rem; }
        .header .phone { color: #e63946; font-size: 1.2rem; font-weight: 700; }
        .nav-links { display: flex; gap: 20px; align-items: center; }
        .nav-links a { color: #333; text-decoration: none; font-weight: 600; transition: color 0.2s; }
        .nav-links a:hover { color: #0066cc; }
        .breadcrumbs { max-width: 1400px; margin: 20px auto; padding: 0 20px; color: #666; }
        .breadcrumbs a { color: #0066cc; text-decoration: none; }
        .container { max-width: 1400px; margin: 20px auto; padding: 0 20px; display: grid; grid-template-columns: 200px 1fr 280px; gap: 20px; }
        .tools-sidebar { background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); overflow: hidden; }
        .tool-btn { display: flex; flex-direction: column; align-items: center; padding: 20px 10px; border: none; border-bottom: 1px solid #e0e0e0; background: white; cursor: pointer; width: 100%; transition: background 0.2s; }
        .tool-btn:hover { background: #f0f7ff; }
        .tool-btn.active { background: #0066cc; color: white; }
        .tool-icon { font-size: 2.5rem; margin-bottom: 8px; }
        .tool-label { font-size: 0.85rem; font-weight: 600; text-align: center; }
        .canvas-area { background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 30px; }
        .canvas-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #e0e0e0; }
        .canvas-info { display: flex; gap: 30px; align-items: center; flex-wrap: wrap; }
        .canvas-info label { font-weight: 600; margin-right: 10px; }
        .canvas-wrapper { border: 3px solid #000; background: white; position: relative; margin: 0 auto; box-shadow: 0 4px 12px rgba(0,0,0,0.15); cursor: crosshair; display: inline-block; }
        #designCanvas { display: block; }
        .undo-btn { position: absolute; top: 10px; right: 10px; background: white; border: 2px solid #ccc; border-radius: 50%; width: 45px; height: 45px; font-size: 1.2rem; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.2); z-index: 10; }
        .settings-sidebar { background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 20px; }
        .settings-panel { display: none; }
        .settings-panel.active { display: block; }
        .panel-title { background: #0066cc; color: white; padding: 12px; margin: -20px -20px 20px -20px; font-weight: 600; }
        .control-group { margin-bottom: 20px; }
        .control-group label { display: block; font-weight: 600; margin-bottom: 8px; }
        .control-group input, .control-group select, .control-group button, .control-group textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; }
        .control-group button { background: #444; color: white; cursor: pointer; font-weight: 600; }
        .color-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 8px; margin-top: 10px; }
        .color-swatch { width: 100%; padding-top: 100%; border-radius: 4px; cursor: pointer; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 6px; font-size: 1.1rem; font-weight: 700; cursor: pointer; margin-bottom: 10px; }
        .btn-primary { background: #e63946; color: white; }
        .btn-primary:hover { background: #d62828; }
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center; padding: 20px; }
        .modal.show { display: flex; }
        .modal-content { background: white; border-radius: 10px; max-width: 600px; width: 100%; max-height: 85vh; overflow-y: auto; padding: 30px; }
        .modal h2 { color: #1D3557; margin-bottom: 20px; }
        .alert { padding: 15px; border-radius: 6px; margin-bottom: 20px; }
        .alert-success { background: #d4edda; color: #155724; border: 2px solid #c3e6cb; }
        @media (max-width: 1200px) { .container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="top-bar"><img src="./tcsignlab.png" alt="TC SignLab" onerror="this.style.display='none'"></div>
    
    <div class="header">
        <div class="header-content">
            <div>
                <h1>Design & Request Quote</h1>
                <p>Call us: <span class="phone">866-419-7446</span></p>
            </div>
            <div class="nav-links">
                <a href="./index.html">Home</a>
                <a href="./products.html">Products</a>
                <a href="./configurator.html">Design Tool</a>
                <a href="#" onclick="openContactForm(); return false;">Contact</a>
                <a href="./checkout.html">Cart</a>
                <a href="./login.html" id="loginLink">Login</a>
            </div>
        </div>
    </div>
    
    <div class="breadcrumbs"><a href="./index.html">Home</a> / <span>Design Tool</span></div>
    
    <div class="container">
        <aside class="tools-sidebar">
            <button class="tool-btn active" onclick="selectTool('text')" data-tool="text">
                <div class="tool-icon">T</div>
                <div class="tool-label">Add<br>TEXT</div>
            </button>
            <button class="tool-btn" onclick="selectTool('image')" data-tool="image">
                <div class="tool-icon">üñºÔ∏è</div>
                <div class="tool-label">Upload<br>IMAGE</div>
            </button>
            <button class="tool-btn" onclick="selectTool('background')" data-tool="background">
                <div class="tool-icon">üé®</div>
                <div class="tool-label">Add<br>BCKGND</div>
            </button>
        </aside>
        
        <main class="canvas-area">
            <div class="canvas-header">
                <div class="canvas-info">
                    <div>
                        <label>Size (H x W):</label>
                        <input type="number" id="customHeight" value="2" min="1" max="12" step="0.5" style="width:70px" onchange="updateCanvasSize()"> ft x
                        <input type="number" id="customWidth" value="4" min="1" max="25" step="0.5" style="width:70px" onchange="updateCanvasSize()"> ft
                    </div>
                    <div>
                        <label>Quantity:</label>
                        <select id="quantity">
                            <option value="1">1</option>
                            <option value="5">5</option>
                            <option value="10">10</option>
                            <option value="25">25</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div style="position: relative; text-align: center;">
                <div class="canvas-wrapper" id="canvasWrapper">
                    <canvas id="designCanvas" width="800" height="400"></canvas>
                </div>
                <button class="undo-btn" onclick="undo()" title="Undo">‚Ü∂</button>
            </div>
            
            <div style="margin-top: 30px; text-align: center;">
                <button class="btn btn-primary" onclick="requestQuote()">üìß Request Quote for This Design</button>
                <p style="margin-top: 15px; color: #666; font-size: 0.9rem;">
                    Design your banner, then request a quote. We'll respond within 24 hours!
                </p>
            </div>
        </main>
        
        <aside class="settings-sidebar">
            <div id="textPanel" class="settings-panel active">
                <div class="panel-title">Text Settings</div>
                <div class="control-group">
                    <label>Text</label>
                    <input type="text" id="textInput" placeholder="Enter your text">
                </div>
                <div class="control-group">
                    <label>Font</label>
                    <select id="fontSelect">
                        <option>Roboto</option>
                        <option>Open Sans</option>
                        <option>Montserrat</option>
                        <option>Lato</option>
                        <option>Oswald</option>
                        <option>Arial</option>
                        <option>Impact</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>Size: <span id="fontSizeValue">48px</span></label>
                    <input type="range" id="fontSize" min="10" max="200" value="48" oninput="document.getElementById('fontSizeValue').textContent = this.value + 'px'">
                </div>
                <div class="control-group">
                    <label>Color</label>
                    <input type="color" id="textColor" value="#000000">
                    <div class="color-grid">
                        <div class="color-swatch" style="background:#000000" onclick="document.getElementById('textColor').value='#000000'"></div>
                        <div class="color-swatch" style="background:#FFFFFF; border:1px solid #ccc" onclick="document.getElementById('textColor').value='#FFFFFF'"></div>
                        <div class="color-swatch" style="background:#E63946" onclick="document.getElementById('textColor').value='#E63946'"></div>
                        <div class="color-swatch" style="background:#0066CC" onclick="document.getElementById('textColor').value='#0066CC'"></div>
                        <div class="color-swatch" style="background:#28A745" onclick="document.getElementById('textColor').value='#28A745'"></div>
                        <div class="color-swatch" style="background:#FFC107" onclick="document.getElementById('textColor').value='#FFC107'"></div>
                    </div>
                </div>
                <button class="control-group" onclick="addText()">Add Text to Canvas</button>
            </div>
            
            <div id="imagePanel" class="settings-panel">
                <div class="panel-title">Image Upload</div>
                <div class="control-group">
                    <button onclick="document.getElementById('imageUpload').click()">üì§ Upload Image</button>
                    <input type="file" id="imageUpload" accept="image/*" style="display:none" onchange="handleImageUpload(event)">
                </div>
                <div class="control-group">
                    <button onclick="matchCanvas()">üìê Fit to Canvas</button>
                </div>
                <div class="control-group">
                    <button onclick="deleteSelected()">üóëÔ∏è Delete Selected</button>
                </div>
                <div class="control-group">
                    <button onclick="startOver()">üîÑ Clear All</button>
                </div>
                <div id="uploadStatus" style="margin-top:15px; text-align:center; color:#666; font-size:0.85rem;"></div>
            </div>
            
            <div id="backgroundPanel" class="settings-panel">
                <div class="panel-title">Background</div>
                <div class="control-group">
                    <label>Color</label>
                    <input type="color" id="bgColor" value="#FFFFFF" onchange="redraw()">
                    <div class="color-grid">
                        <div class="color-swatch" style="background:#FFFFFF; border:1px solid #ccc" onclick="document.getElementById('bgColor').value='#FFFFFF'; redraw()"></div>
                        <div class="color-swatch" style="background:#000000" onclick="document.getElementById('bgColor').value='#000000'; redraw()"></div>
                        <div class="color-swatch" style="background:#E63946" onclick="document.getElementById('bgColor').value='#E63946'; redraw()"></div>
                        <div class="color-swatch" style="background:#0066CC" onclick="document.getElementById('bgColor').value='#0066CC'; redraw()"></div>
                        <div class="color-swatch" style="background:#28A745" onclick="document.getElementById('bgColor').value='#28A745'; redraw()"></div>
                        <div class="color-swatch" style="background:#FFC107" onclick="document.getElementById('bgColor').value='#FFC107'; redraw()"></div>
                    </div>
                </div>
            </div>
        </aside>
    </div>
    
    <div id="quoteModal" class="modal">
        <div class="modal-content">
            <h2>Request a Quote for Your Design</h2>
            <p style="color:#666; margin-bottom:20px;">Fill out the form below and we'll send you a detailed quote within 24 hours.</p>
            <div id="quoteAlert"></div>
            <form id="quoteForm" onsubmit="submitQuote(event)">
                <div class="control-group"><label>Your Name *</label><input type="text" id="quoteName" required></div>
                <div class="control-group"><label>Email Address *</label><input type="email" id="quoteEmail" required></div>
                <div class="control-group"><label>Phone Number</label><input type="tel" id="quotePhone" placeholder="(555) 123-4567"></div>
                <div class="control-group"><label>Company Name (Optional)</label><input type="text" id="quoteCompany"></div>
                <div style="background:#f8f9fa; padding:15px; border-radius:6px; margin-bottom:20px;">
                    <h4 style="margin-bottom:10px;">Design Specifications:</h4>
                    <p><strong>Size:</strong> <span id="displaySize"></span></p>
                    <p><strong>Quantity:</strong> <span id="displayQuantity"></span></p>
                </div>
                <div class="control-group">
                    <label>Material Preference (Optional)</label>
                    <select id="quoteMaterial">
                        <option value="">-- Select Material --</option>
                        <option value="Vinyl Banner">Vinyl Banner (Standard)</option>
                        <option value="Mesh Banner">Mesh Banner (Wind Resistant)</option>
                        <option value="Fabric Banner">Fabric Banner (Premium)</option>
                        <option value="Not Sure">Not Sure - Need Recommendation</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>Finishing Options (Optional)</label>
                    <div style="margin-top:10px;">
                        <label style="display:block; margin-bottom:8px;"><input type="checkbox" id="finishGrommets" value="Grommets"> Hems & Grommets</label>
                        <label style="display:block; margin-bottom:8px;"><input type="checkbox" id="finishPockets" value="Pole Pockets"> Pole Pockets</label>
                        <label style="display:block; margin-bottom:8px;"><input type="checkbox" id="finishRope" value="Rope"> Rope & Grommets</label>
                        <label style="display:block; margin-bottom:8px;"><input type="checkbox" id="finishSlits" value="Wind Slits"> Wind Slits</label>
                    </div>
                </div>
                <div class="control-group"><label>When do you need this?</label><input type="date" id="quoteDeadline" min=""></div>
                <div class="control-group"><label>Additional Notes or Special Requests</label><textarea id="quoteNotes" rows="4" placeholder="Any special requirements, questions, or details about your project..."></textarea></div>
                <div style="background:#fff3cd; padding:15px; border-radius:6px; margin-bottom:20px; border:2px solid #ffc107;">
                    <p style="margin:0; font-size:0.9rem;"><strong>üìé Your design will be attached to the quote request.</strong><br>We'll review it and provide pricing based on your specifications.</p>
                </div>
                <button type="submit" class="btn btn-primary">Send Quote Request</button>
                <button type="button" class="btn" onclick="closeModal()" style="background:#6c757d; color:white;">Cancel</button>
            </form>
        </div>
    </div>
    
    <div id="contactModal" class="modal">
        <div class="modal-content">
            <h2>Contact Us</h2>
            <form id="contactForm" onsubmit="submitContact(event)">
                <div class="control-group"><label>Name *</label><input type="text" id="contactName" required></div>
                <div class="control-group"><label>Email *</label><input type="email" id="contactEmail" required></div>
                <div class="control-group"><label>Phone</label><input type="tel" id="contactPhone"></div>
                <div class="control-group"><label>Subject *</label><input type="text" id="contactSubject" required></div>
                <div class="control-group"><label>Message *</label><textarea id="contactMessage" rows="4" required></textarea></div>
                <button type="submit" class="btn btn-primary">Send Message</button>
                <button type="button" class="btn" onclick="closeModal()" style="background:#6c757d; color:white;">Cancel</button>
            </form>
        </div>
    </div>
    
    <script>
        let canvas, ctx, canvasObjects = [], selectedIndex = null, isDragging = false, isResizing = false;
        let dragStart = {x: 0, y: 0}, resizeHandle = null, history = [];
        
        window.addEventListener('DOMContentLoaded', () => {
            canvas = document.getElementById('designCanvas');
            ctx = canvas.getContext('2d');
            canvas.addEventListener('mousedown', handleMouseDown);
            canvas.addEventListener('mousemove', handleMouseMove);
            canvas.addEventListener('mouseup', handleMouseUp);
            canvas.addEventListener('mouseleave', handleMouseUp);
            document.getElementById('quoteDeadline').setAttribute('min', new Date().toISOString().split('T')[0]);
            loadGoogleFonts();
            redraw();
        });
        
        function loadGoogleFonts() {
            const link = document.createElement('link');
            link.href = 'https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Open+Sans:wght@400;700&family=Montserrat:wght@400;700&family=Lato:wght@400;700&family=Oswald:wght@400;700&display=swap';
            link.rel = 'stylesheet';
            document.head.appendChild(link);
        }
        
        window.selectTool = function(tool) {
            document.querySelectorAll('.tool-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-tool="${tool}"]`).classList.add('active');
            document.querySelectorAll('.settings-panel').forEach(panel => panel.classList.remove('active'));
            document.getElementById(tool + 'Panel').classList.add('active');
        };
        
        function handleMouseDown(e) {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left, y = e.clientY - rect.top;
            if (selectedIndex !== null) {
                const handle = getResizeHandle(x, y, canvasObjects[selectedIndex]);
                if (handle) { isResizing = true; resizeHandle = handle; dragStart = {x, y}; return; }
            }
            for (let i = canvasObjects.length - 1; i >= 0; i--) {
                if (isPointInObject(x, y, canvasObjects[i])) {
                    selectedIndex = i; isDragging = true; dragStart = {x, y}; redraw(); return;
                }
            }
            selectedIndex = null; redraw();
        }
        
        function handleMouseMove(e) {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left, y = e.clientY - rect.top;
            if (isResizing && selectedIndex !== null) {
                const obj = canvasObjects[selectedIndex], dx = x - dragStart.x, dy = y - dragStart.y;
                if (obj.type === 'image') {
                    const ar = obj.img.width / obj.img.height;
                    if (resizeHandle === 'se') { obj.width += dx; obj.height = obj.width / ar; }
                    else if (resizeHandle === 'sw') { obj.width -= dx; obj.height = obj.width / ar; obj.x += dx; }
                    else if (resizeHandle === 'ne') { obj.width += dx; obj.height = obj.width / ar; obj.y -= dy; }
                    else if (resizeHandle === 'nw') { obj.width -= dx; obj.height = obj.width / ar; obj.x += dx; }
                    dragStart = {x, y}; redraw();
                }
            } else if (isDragging && selectedIndex !== null) {
                const obj = canvasObjects[selectedIndex];
                obj.x += x - dragStart.x; obj.y += y - dragStart.y;
                dragStart = {x, y}; redraw();
            } else if (selectedIndex !== null) {
                canvas.style.cursor = getResizeHandle(x, y, canvasObjects[selectedIndex]) ? 'nwse-resize' : 'move';
            } else { canvas.style.cursor = 'crosshair'; }
        }
        
        function handleMouseUp() {
            if (isDragging || isResizing) saveHistory();
            isDragging = false; isResizing = false; resizeHandle = null;
        }
        
        function isPointInObject(x, y, obj) {
            if (obj.type === 'text') {
                ctx.font = `${obj.fontSize}px ${obj.font}`;
                const m = ctx.measureText(obj.content), w = m.width, h = obj.fontSize;
                return x >= obj.x - w/2 - 10 && x <= obj.x + w/2 + 10 && y >= obj.y - h/2 - 10 && y <= obj.y + h/2 + 10;
            } else if (obj.type === 'image') {
                return x >= obj.x && x <= obj.x + obj.width && y >= obj.y && y <= obj.y + obj.height;
            }
            return false;
        }
        
        function getResizeHandle(x, y, obj) {
            if (!obj || obj.type !== 'image') return null;
            const hs = 10, handles = {
                'nw': {x: obj.x, y: obj.y},
                'ne': {x: obj.x + obj.width, y: obj.y},
                'sw': {x: obj.x, y: obj.y + obj.height},
                'se': {x: obj.x + obj.width, y: obj.y + obj.height}
            };
            for (let [name, pos] of Object.entries(handles)) {
                if (x >= pos.x - hs && x <= pos.x + hs && y >= pos.y - hs && y <= pos.y + hs) return name;
            }
            return null;
        }
        
        window.addText = function() {
            const text = document.getElementById('textInput').value;
            if (!text) { alert('Please enter some text'); return; }
            canvasObjects.push({
                type: 'text', content: text, x: canvas.width / 2, y: canvas.height / 2,
                fontSize: parseInt(document.getElementById('fontSize').value),
                font: document.getElementById('fontSelect').value,
                color: document.getElementById('textColor').value
            });
            selectedIndex = canvasObjects.length - 1;
            saveHistory(); redraw();
            document.getElementById('textInput').value = '';
        };
        
        window.handleImageUpload = function(event) {
            const file = event.target.files[0];
            if (!file) return;
            document.getElementById('uploadStatus').textContent = '‚è≥ Uploading...';
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    const scale = Math.min(canvas.width / img.width, canvas.height / img.height, 1) * 0.8;
                    canvasObjects.push({
                        type: 'image', img: img,
                        x: (canvas.width - img.width * scale) / 2,
                        y: (canvas.height - img.height * scale) / 2,
                        width: img.width * scale, height: img.height * scale
                    });
                    selectedIndex = canvasObjects.length - 1;
                    saveHistory(); redraw();
                    document.getElementById('uploadStatus').textContent = '‚úì Image added! Click & drag to move, resize with corners.';
                    setTimeout(() => document.getElementById('uploadStatus').textContent = '', 5000);
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        };
        
        window.matchCanvas = function() {
            if (selectedIndex === null || canvasObjects[selectedIndex].type !== 'image') {
                alert('Please select an image first'); return;
            }
            const obj = canvasObjects[selectedIndex];
            obj.x = 0; obj.y = 0; obj.width = canvas.width; obj.height = canvas.height;
            saveHistory(); redraw();
        };
        
        window.deleteSelected = function() {
            if (selectedIndex !== null) {
                canvasObjects.splice(selectedIndex, 1);
                selectedIndex = null; saveHistory(); redraw();
            } else { alert('Please select an element first'); }
        };
        
        window.startOver = function() {
            if (confirm('Clear all design elements?')) {
                canvasObjects = []; selectedIndex = null; history = []; redraw();
            }
        };
        
        window.undo = function() {
            if (history.length > 0) {
                canvasObjects = JSON.parse(history.pop());
                selectedIndex = null; redraw();
            }
        };
        
        function saveHistory() {
            history.push(JSON.stringify(canvasObjects));
            if (history.length > 20) history.shift();
        }
        
        window.redraw = function() {
            ctx.fillStyle = document.getElementById('bgColor').value;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            canvasObjects.forEach((obj, i) => {
                if (obj.type === 'text') {
                    ctx.font = `${obj.fontSize}px ${obj.font}`;
                    ctx.fillStyle = obj.color;
                    ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                    ctx.fillText(obj.content, obj.x, obj.y);
                } else if (obj.type === 'image') {
                    ctx.drawImage(obj.img, obj.x, obj.y, obj.width, obj.height);
                }
                if (i === selectedIndex) {
                    ctx.strokeStyle = '#0066cc'; ctx.lineWidth = 2; ctx.setLineDash([5, 5]);
                    if (obj.type === 'text') {
                        const m = ctx.measureText(obj.content), w = m.width, h = obj.fontSize;
                        ctx.strokeRect(obj.x - w/2 - 5, obj.y - h/2 - 5, w + 10, h + 10);
                    } else if (obj.type === 'image') {
                        ctx.strokeRect(obj.x - 2, obj.y - 2, obj.width + 4, obj.height + 4);
                        const hs = 8;
                        ctx.fillStyle = '#0066cc'; ctx.setLineDash([]);
                        ctx.fillRect(obj.x - hs/2, obj.y - hs/2, hs, hs);
                        ctx.fillRect(obj.x + obj.width - hs/2, obj.y - hs/2, hs, hs);
                        ctx.fillRect(obj.x - hs/2, obj.y + obj.height - hs/2, hs, hs);
                        ctx.fillRect(obj.x + obj.width - hs/2, obj.y + obj.height - hs/2, hs, hs);
                    }
                    ctx.setLineDash([]);
                }
            });
        };
        
        window.updateCanvasSize = function() {
            const hFt = parseFloat(document.getElementById('customHeight').value);
            const wFt = parseFloat(document.getElementById('customWidth').value);
            const ratio = wFt / hFt, maxW = 900, maxH = 600;
            if (ratio > maxW / maxH) { canvas.width = maxW; canvas.height = maxW / ratio; }
            else { canvas.height = maxH; canvas.width = maxH * ratio; }
            redraw();
        };
        
        window.requestQuote = function() {
            if (canvasObjects.length === 0) { alert('‚ö†Ô∏è Please add some design elements first!'); return; }
            document.getElementById('displaySize').textContent = `${document.getElementById('customHeight').value}' x ${document.getElementById('customWidth').value}'`;
            document.getElementById('displayQuantity').textContent = document.getElementById('quantity').value;
            document.getElementById('quoteModal').classList.add('show');
        };
        
        window.submitQuote = async function(e) {
            e.preventDefault();
            const alertBox = document.getElementById('quoteAlert');
            alertBox.innerHTML = '<div class="alert alert-success">‚è≥ Sending quote request...</div>';
            const finishing = [];
            if (document.getElementById('finishGrommets').checked) finishing.push('Hems & Grommets');
            if (document.getElementById('finishPockets').checked) finishing.push('Pole Pockets');
            if (document.getElementById('finishRope').checked) finishing.push('Rope & Grommets');
            if (document.getElementById('finishSlits').checked) finishing.push('Wind Slits');
            const quoteData = {
                _subject: 'TC SignLab - Quote Request from Design Tool',
                _template: 'box',
                Name: document.getElementById('quoteName').value,
                Email: document.getElementById('quoteEmail').value,
                Phone: document.getElementById('quotePhone').value || 'Not provided',
                Company: document.getElementById('quoteCompany').value || 'Not provided',
                Size: `${document.getElementById('customHeight').value}' x ${document.getElementById('customWidth').value}'`,
                Quantity: document.getElementById('quantity').value,
                Material: document.getElementById('quoteMaterial').value || 'Not specified',
                'Finishing Options': finishing.length > 0 ? finishing.join(', ') : 'Not specified',
                Deadline: document.getElementById('quoteDeadline').value || 'Not specified',
                'Additional Notes': document.getElementById('quoteNotes').value || 'None',
                'Design Preview': 'Attached as image data'
            };
            try {
                const response = await fetch('https://formsubmit.co/tcsignlab@gmail.com', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(quoteData)
                });
                if (response.ok) {
                    alertBox.innerHTML = '<div class="alert alert-success">‚úì Quote request sent successfully! We\'ll respond within 24 hours.</div>';
                    setTimeout(() => { closeModal(); document.getElementById('quoteForm').reset(); alertBox.innerHTML = ''; }, 3000);
                } else { throw new Error('Failed to send'); }
            } catch (error) {
                alertBox.innerHTML = '<div class="alert" style="background:#f8d7da; color:#721c24;">‚ùå Error sending request. Please try again or call us at 866-419-7446.</div>';
            }
        };
        
        window.openContactForm = function() {
            document.getElementById('contactModal').classList.add('show');
        };
        
        window.submitContact = async function(e) {
            e.preventDefault();
            const contactData = {
                _subject: `TC SignLab - ${document.getElementById('contactSubject').value}`,
                _template: 'box',
                Name: document.getElementById('contactName').value,
                Email: document.getElementById('contactEmail').value,
                Phone: document.getElementById('contactPhone').value || 'Not provided',
                Subject: document.getElementById('contactSubject').value,
                Message: document.getElementById('contactMessage').value
            };
            try {
                await fetch('https://formsubmit.co/tcsignlab@gmail.com', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(contactData)
                });
                alert('‚úì Message sent! We\'ll respond soon.');
                closeModal(); document.getElementById('contactForm').reset();
            } catch (error) {
                alert('‚ùå Error sending message. Please try again.');
            }
        };
        
        window.closeModal = function() {
            document.querySelectorAll('.modal').forEach(modal => modal.classList.remove('show'));
        };
        
        updateCanvasSize();
    </script>
</body>
</html>
